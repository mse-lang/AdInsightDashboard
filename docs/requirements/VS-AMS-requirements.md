# 벤처스퀘어 광고 관리 시스템 (VS-AMS) 요구사항 정의서

## 1. 문서 개요

### 1.1 목적
VS-AMS 프로젝트의 사업적 목표와 기능적/비기능적 요구사항을 명확히 정의하여, 설계·개발·테스트 및 운영 단계에서 공통된 기준(reference)을 제공합니다.

### 1.2 범위
- 벤처스퀘어 광고 운영 조직이 활용하는 웹 기반 광고 관리 대시보드
- 광고주 관리, 캠페인 집행, 커뮤니케이션, 성과 분석, 견적·정산 업무 전 과정
- Airtable을 메인 데이터 저장소로 사용하며, Google API 및 Solapi 등 외부 서비스 연동을 포함

### 1.3 참고 문서
- VS-AMS 시스템 아키텍처 제안서 (동일 프로젝트 문서)
- Airtable API 공식 문서
- Google Cloud (OAuth, Calendar, Gmail, GA4) API 문서
- Solapi API 가이드

### 1.4 변경 관리
- 요구사항 변경 시 Change Request를 발행하고, 문서 버전을 업데이트합니다.
- 변경 이력은 `docs/requirements` 디렉터리 내 별도 로그 또는 Git 이력으로 관리합니다.

## 2. 프로젝트 개요

### 2.1 시스템 목표
- 광고 운영 전 과정의 효율화 및 자동화
- 광고주와의 커뮤니케이션 히스토리 통합 관리
- 실시간 성과 분석 기반 의사결정 지원
- 견적, 세금계산서 등 행정 업무의 오류 최소화

### 2.2 주요 가치 제안
- **단일 대시보드**: 흩어진 업무 도구를 일원화하여 이동 비용 감소
- **데이터 신뢰성 확보**: Airtable을 중심으로 모든 엔터티를 구조화
- **자동화**: 이메일/문자 발송, 일정 연동, 성과 리포트 등 반복 업무 자동화
- **확장성**: 향후 신규 광고 상품, 리포트 포맷 추가가 용이한 구조 제공

### 2.3 용어 정의
| 용어 | 정의 |
|------|------|
| 광고주(Advertiser) | 벤처스퀘어의 광고 상품을 구매·이용하는 고객사 |
| 캠페인(Campaign) | 특정 광고주가 일정 기간 진행하는 광고 집행 단위 |
| 소재(Creative) | 캠페인에 활용되는 이미지, 영상, 텍스트 등 광고 자산 |
| 견적(Quote) | 광고주에게 제공하는 비용 산정 문서 |
| 세금계산서(Invoice) | 확정된 견적을 기반으로 발행하는 세금계산서 |
| 커뮤니케이션 로그 | 광고주와 주고받은 메일, SMS, 카카오톡 등 소통 기록 |

## 3. 이해관계자 및 사용자

### 3.1 이해관계자
- **벤처스퀘어 경영진**: 광고 수익 및 KPI 모니터링
- **광고사업팀 AE**: 광고주 커뮤니케이션, 캠페인 실행, 보고 책임
- **재무/정산팀**: 견적 승인, 발행 및 회계 처리
- **기술운영팀**: 시스템 유지보수 및 운영 자동화 관리

### 3.2 사용자 유형 및 권한
| 사용자 유형 | 설명 | 권한 요약 |
|--------------|------|-----------|
| 관리자(Admin) | mse@venturesquare.net, rosie@venturesquare.net 등 지정 계정 | 전체 모듈 접근, 사용자 관리, 설정 변경 |
| 일반 사용자(User) | AE, 운영 담당자 등 | 본인이 속한 광고주/캠페인 데이터 접근, 일부 작성/수정 권한 |
| 읽기 전용(옵션) | 외부 파트너, 경영진 뷰만 필요 시 | 조회 권한만 부여 (추후 필요 시 도입) |

관리자 여부는 Google 로그인 이메일을 Airtable Users 테이블의 Role 필드와 매핑하여 제어합니다.

## 4. 시스템 개요

### 4.1 아키텍처 요약
- **프론트엔드**: Next.js(React) 기반 웹 대시보드, OAuth 로그인, 데이터 그리드 및 상세 패널 UI
- **백엔드 Orchestrator**: NestJS (Node.js) – 인증 프록시, Airtable/외부 API 연동, 비즈니스 로직 처리
- **Airtable**: 모든 엔터티(사용자, 광고주, 캠페인, 견적, 리포트 등) 저장소 및 관계 관리
- **Background Workers**: BullMQ/Redis 기반 스케줄러 – 이미지 리사이즈, GA4 데이터 수집, 리포트 생성, 정기 발송
- **외부 서비스**: Google APIs (OAuth, Calendar, Gmail, GA4), Solapi (SMS/Email/카카오), S3/GCS (소재 파일), PDF 생성기

### 4.2 환경 구성
| 환경 | 목적 | 비고 |
|------|------|------|
| 개발 | 기능 개발 및 통합 테스트 | Airtable 개발 베이스, 테스트 API 키 사용 |
| 스테이징 | UAT 및 QA | 실제 데이터 샘플, 제한된 외부 연동 |
| 운영 | 실서비스 환경 | 실 API 키, 모니터링/알림 활성화 |

## 5. 기능 요구사항

### 5.1 요구사항 요약
다음 표는 각 모듈별 핵심 기능 요구사항을 정리한 것입니다. 우선순위는 MoSCoW 기법 사용.

#### 5.1.1 사용자 인증 및 관리 (모듈 1)
| ID | 요구사항 | 설명 | 우선순위 |
|----|-----------|------|-----------|
| FR-1.1 | Google OAuth 로그인 | 사용자는 Google 계정으로 SSO 로그인해야 한다. | Must |
| FR-1.2 | 관리자 자동 할당 | 로그인 시 이메일 화이트리스트(mse@, rosie@)는 관리자 Role 부여 | Must |
| FR-1.3 | 사용자 프로필 동기화 | 로그인 시 Airtable Users에 사용자 정보가 생성/업데이트 되어야 한다. | Must |
| FR-1.4 | 권한 기반 접근제어 | 관리자와 일반 사용자에 따라 기능 접근이 제한되어야 한다. | Must |
| FR-1.5 | 세션 관리 | JWT 기반 액세스/리프레시 토큰으로 세션을 유지한다. | Should |

#### 5.1.2 광고주 관리 (모듈 2)
| ID | 요구사항 | 설명 | 우선순위 |
|----|-----------|------|-----------|
| FR-2.1 | 광고주 CRUD | 사용자(관리자/AE)는 Advertisers 테이블과 동기화된 광고주 정보를 조회·등록·수정할 수 있어야 한다. | Must |
| FR-2.2 | 연락처 기반 발송 | 상세 페이지에서 Solapi API로 이메일/SMS/카카오 메시지를 발송할 수 있어야 한다. | Must |
| FR-2.3 | 발송 로그 자동 기록 | 발송 성공/실패 결과가 Communication_Logs에 자동 저장되고 광고주와 연결되어야 한다. | Must |
| FR-2.4 | 검색/필터 | 회사명, 담당자, 산업군 등으로 광고주를 검색 및 필터링 할 수 있어야 한다. | Should |
| FR-2.5 | 인바운드 기록 수집 | Gmail API를 통해 광고주 이메일에서 온 수신 메시지가 자동 분류되어야 한다. | Should |

#### 5.1.3 광고 상품 및 소재 관리 (모듈 3)
| ID | 요구사항 | 설명 | 우선순위 |
|----|-----------|------|-----------|
| FR-3.1 | 상품 카탈로그 관리 | Ad_Products 테이블과 동기화된 광고 상품 정보 CRUD | Must |
| FR-3.2 | 소재 업로드 및 저장 | 광고주별 소재를 업로드하고 외부 스토리지 URL을 Airtable Creatives에 저장해야 한다. | Must |
| FR-3.3 | 규격 자동 변환 | 업로드된 이미지가 상품 규격에 맞게 자동 리사이징/크롭되어 저장되어야 한다. | Must |
| FR-3.4 | 소재 검수 프로세스 | 승인/반려 상태 표시와 검수 메모를 기록할 수 있어야 한다. | Should |
| FR-3.5 | 버전 관리 | 동일 소재의 규격별 버전을 확인할 수 있어야 한다. | Could |

#### 5.1.4 견적 및 정산 (모듈 4)
| ID | 요구사항 | 설명 | 우선순위 |
|----|-----------|------|-----------|
| FR-4.1 | 견적 생성 | Ad_Products 기반으로 수량·기간·할인율을 적용한 견적서를 생성할 수 있어야 한다. | Must |
| FR-4.2 | 견적 저장 | 생성된 견적 정보가 Airtable Quotes 및 Quote_Items에 저장되어야 한다. | Must |
| FR-4.3 | PDF 생성 | 견적서가 PDF로 다운로드 가능해야 하며, 광고주 이메일로 발송할 수 있어야 한다. | Must |
| FR-4.4 | 세금계산서 생성 | 확정 견적을 바탕으로 Invoices 테이블 레코드가 생성되고 상태를 추적해야 한다. | Must |
| FR-4.5 | 정산 현황 대시보드 | 진행 중, 발행 완료, 미수 등 정산 현황을 한눈에 파악할 수 있어야 한다. | Should |

#### 5.1.5 일정 및 커뮤니케이션 자동화 (모듈 5)
| ID | 요구사항 | 설명 | 우선순위 |
|----|-----------|------|-----------|
| FR-5.1 | 캠페인 일정 관리 | Campaigns 테이블에서 시작/종료일을 관리할 수 있어야 한다. | Must |
| FR-5.2 | Google Calendar Sync | 캠페인 일정이 지정된 Google Calendar와 양방향 동기화되어야 한다. | Must |
| FR-5.3 | 이메일 자동 분류 | ad@venturesquare.net 계정으로 수신된 이메일 중 등록된 광고주 발신분은 Communication_Logs와 연동된다. | Should |
| FR-5.4 | 알림 및 태스크 | 마감 임박 캠페인, 발행 대기 견적 등에 대한 알림을 제공해야 한다. | Could |

#### 5.1.6 성과 분석 및 리포팅 (모듈 6)
| ID | 요구사항 | 설명 | 우선순위 |
|----|-----------|------|-----------|
| FR-6.1 | GA4 데이터 연동 | 캠페인별 UTM을 기반으로 GA4 API에서 노출/클릭/전환 데이터를 주기적으로 수집한다. | Must |
| FR-6.2 | Reports 테이블 업데이트 | 수집된 데이터는 Airtable Reports와 Campaigns에 연계된다. | Must |
| FR-6.3 | 리포트 생성 | Reports 데이터를 바탕으로 광고주별/캠페인별 PDF 또는 웹 리포트를 자동 생성한다. | Must |
| FR-6.4 | 정기 발송 | 월간/분기 등 주기에 맞춰 리포트를 Solapi Email로 자동 발송한다. | Should |
| FR-6.5 | 대시보드 시각화 | 주요 KPI(노출, CTR 등)를 차트/테이블로 제공한다. | Should |

### 5.2 시스템 관리 기능
- **사용자 관리**: 관리자만 사용자 Role 변경, 비활성화 가능
- **설정 관리**: Solapi 템플릿, Google Calendar ID 등은 System_Settings 테이블에서 관리
- **감사 로그**: 주요 액션(로그인, 견적 발송, 인보이스 변경 등)은 Audit Trail에 기록 (Communication_Logs 또는 별도 로그)

## 6. 데이터 및 스키마 요구사항

### 6.1 Airtable 베이스 구조 요약
| 테이블 | 목적 | 주요 필드 (예시) |
|--------|------|------------------|
| Users | 사용자 계정 및 권한 관리 | Name, Email, Google UID, Role, Status |
| Advertisers | 광고주 프로필 및 담당자 정보 | 회사명, 담당자, 연락처, AE, 커뮤니케이션 링크 |
| Communication_Logs | 이메일/SMS/카카오 등 발송 및 수신 기록 | 이벤트 유형, 본문, 발신자, 상태, 관련 광고주 |
| Ad_Products | 광고 상품 카탈로그 | 상품명, 규격, 단가, 노출 위치 |
| Creatives | 광고 소재 원본 관리 | 광고주, 캠페인, 파일 URL, 상태 |
| Creative_Variants (옵션) | 규격별 변환본 | Creative 링크, 규격, 변환 URL |
| Campaigns | 캠페인 일정 및 상품 연결 | 광고주, 상품, 일정, 상태, Calendar ID |
| Quotes | 견적서 헤더 정보 | 광고주, 총액, 상태, PDF 링크 |
| Quote_Items | 견적 항목 상세 | 상품, 수량, 단가, 합계 |
| Invoices | 세금계산서 추적 | Quote 링크, 금액, 상태 |
| Reports | 성과 데이터 및 리포트 파일 | KPI, 기간, 리포트 링크 |
| System_Settings | API 키, 템플릿 등 | Category, Value |

### 6.2 데이터 품질 요구사항
- 필수 필드(예: 광고주 이메일, 캠페인 일정)는 유효성 검사를 통과해야 함
- 중복 광고주 방지: 사업자번호 또는 회사명 + 담당자 조합으로 중복 체크
- 연동 키 관리: Google Calendar Event ID, GA4 Property ID 등은 테이블에 저장
- 감사 용도: Created/Last Modified 필드 활성화하여 변경 이력 추적

### 6.3 보관 및 삭제 정책
- 광고주/캠페인 데이터는 최소 3년간 보관
- 계약 종료 후 30일 이내에 요청 시 광고주 소재 파일 삭제 가능 (URL 무효화)
- 로그 데이터는 1년 주기로 보관하며, 장기 보관은 외부 스토리지 아카이빙 고려

## 7. 외부 연동 요구사항

### 7.1 Google OAuth
- OAuth 2.0 Authorization Code Flow 적용
- Redirect URI는 환경별로 분리 관리 (Dev/Staging/Prod)
- Access Token/Refresh Token 암호화 저장, 최소 권한만 요청

### 7.2 Google Calendar API
- 특정 내부 캘린더 ID와 양방향 동기화
- 이벤트 생성 시 참석자(관련 담당자) 자동 추가 옵션
- Calendar 업데이트 실패 시 재시도 로직 필요 (최대 3회)

### 7.3 Gmail API
- ad@venturesquare.net 계정에 Pub/Sub Watch 등록
- 수신 메일 필터: Advertisers 이메일 목록과 매칭
- 본문 요약 및 첨부 파일 처리 시 개인정보 보호 준수

### 7.4 Google Analytics (GA4) API
- UTM 파라미터: 캠페인 생성 시 자동 생성 및 기록
- 데이터 수집 주기: 기본 1일, 필요 시 1시간 단위 집계
- Metric/Dimension: 세션, 페이지뷰, 이벤트 전환, 사용자 수 등 정의

### 7.5 Solapi API
- 메시지 발송: 이메일/SMS/카카오 템플릿 관리
- 발송 결과 Webhook 수신 후 Communication_Logs 업데이트
- 실패/제한 시 재시도 정책 및 알림 필요

### 7.6 파일 스토리지 (S3/GCS)
- Presigned URL로 업로드, 업로드 후 백엔드 워커가 변환 작업 수행
- 폴더 구조: `/original/{campaignId}/` 및 `/variants/{campaignId}/{size}/`
- 보안: 버킷은 private, 리포트/소재 다운로드 시 서명 URL 발급

## 8. 비기능 요구사항

### 8.1 보안
- HTTPS 전 구간 암호화
- OAuth 토큰 및 API 키는 Secrets Manager에 저장
- 관리자 기능은 MFA 적용 고려
- 데이터 접근 로깅 및 이상 행위 탐지

### 8.2 성능
- 대시보드 주요 화면은 3초 이내 로딩 (Airtable API 캐싱 활용)
- 이미지 리사이징 Job은 업로드 후 2분 이내 완료 목표
- GA4 데이터 수집 Job은 스케줄링 후 5분 내 처리

### 8.3 가용성 및 복구
- 운영 환경 가용성 99.5% 이상
- 주요 워커(Job) 장애 시 알림 및 자동 재시작 구성
- 데이터 백업: Airtable 스냅샷 + 외부 리포트 파일 주기적 백업

### 8.4 확장성
- 신규 광고 상품/소재 규격 추가 시 코드 수정 최소화 (테이블 기반 설정)
- 모듈 간 인터페이스는 API/서비스 레이어 추상화 유지
- 큐 작업은 수평 확장 가능한 Redis/큐 서비스 사용

### 8.5 사용성
- 데스크톱 브라우저 최적화 (Chrome/Edge 최신 버전)
- 접근성 지표 (명도 대비, 키보드 내비게이션) 준수
- Airtable과 유사한 UX로 AE의 학습 부담 최소화

### 8.6 유지보수성
- 코드베이스는 TypeScript 기반, ESLint/Prettier 적용
- 주요 기능에는 단위/통합 테스트 케이스 작성
- 인프라 IaC(Terraform/CDK) 적용 고려

## 9. 운영 및 모니터링 요구사항
- **로그 수집**: 백엔드와 워커는 구조화된 로그를 CloudWatch/Datadog 등에 전송
- **알림**: 중요 오류(발송 실패, Sync 실패 등)는 Slack/Email 알림
- **배포 파이프라인**: GitHub Actions로 CI/CD, 코드 리뷰 및 자동 테스트 필수
- **비상 대응**: 장애 대응 Runbook 작성, 관리자 연락체계 구축

## 10. 수용 기준 및 KPI
| 구분 | 수용 기준 | KPI |
|------|------------|-----|
| 인증 | Google OAuth로 관리자/사용자 구분 로그인 가능 | 로그인 성공률 99% |
| 광고주 관리 | 발송 로그 자동 기록, 이메일/SMS 발송 성공 | 발송 성공률 97% 이상 |
| 소재 관리 | 업로드 후 규격 변환 완료 | 평균 처리 시간 2분 이내 |
| 견적/정산 | 견적 PDF 자동 생성, 세금계산서 상태 추적 | 견적 생성 → 발송 5분 내 |
| 일정/커뮤니케이션 | 캠페인 일정 Calendar 동기화, 인바운드 메일 매칭 | 동기화 지연 5분 이내 |
| 성과 리포팅 | GA4 데이터 연동 및 월간 리포트 자동 발송 | 월간 리포트 발송 성공률 95% |

## 11. 단계별 일정(예시)
| 단계 | 기간 | 주요 산출물 |
|------|------|--------------|
| 기획/설계 | 2주 | 요구사항 정의서(본 문서), 상세 설계서 |
| MVP 개발 | 6주 | 모듈 1~4 기본 기능, Airtable 연동, UI 1차 |
| 확장 개발 | 4주 | 모듈 5~6, 자동화 워커, 리포트 생성 |
| 테스트/UAT | 2주 | 테스트 케이스, 사용자 검증, 교육 자료 |
| 런치/운영 | 1주 | 운영 전환, 모니터링 세팅 |

## 12. 가정 및 제약 사항
- Google, Solapi, Airtable API 사용을 위한 계정 및 권한이 제공된다는 가정
- Airtable API Rate Limit(초당 5회 호출)을 초과하지 않도록 큐잉/캐싱 필요
- 개인정보(이메일, 연락처) 처리 시 대한민국 개인정보보호법 준수
- 외부 시스템 장애 시 시스템 가용성에 영향이 있을 수 있으며, 재시도/알림 정책으로 대응

## 13. 향후 고려 사항
- 광고 성과와 CRM 데이터를 기반으로 추천/예측 모델 도입
- Slack/Teams 등 협업툴과의 추가 연동
- BI 도구(Tableau, Looker Studio)와의 직접 연동 옵션
- 외부 파트너(미디어)용 뷰 또는 포털 제공

---
**작성일**: 2025-11-16

**작성자**: 시스템 아키텍트 (ChatGPT)
